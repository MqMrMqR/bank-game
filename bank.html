<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANK GAME - النظام المصرفي الافتراضي</title>
    <style>
        :root {
            --primary: #1a56db;
            --secondary: #6875f5;
            --dark: #1e293b;
            --light: #f3f4f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: var(--dark);
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 28px;
            font-weight: bold;
            text-align: center;
        }
        
        nav {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            justify-content: center;
            padding: 15px 0;
        }
        
        nav li {
            margin: 0 15px;
        }
        
        nav a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        nav a:hover {
            background-color: var(--light);
            color: var(--primary);
        }
        
        nav a.active {
            background-color: var(--primary);
            color: white;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card h2 {
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: 1px solid var(--light);
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .account-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            background-color: var(--light);
        }
        
        .account-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .account-balance {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        table th, table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }
        
        table th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .alert-danger {
            background-color: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .crypto-wallet {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8fafc;
        }

        .crypto-wallet h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .wallet-address {
            padding: 10px;
            background-color: var(--light);
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
            margin-bottom: 10px;
        }

        .crypto-balance {
            font-size: 20px;
            font-weight: bold;
            color: var(--secondary);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f9fafb;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-left: 5px;
        }

        .tab.active {
            background-color: white;
            border-bottom-color: white;
            font-weight: bold;
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        footer {
            background-color: var(--dark);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
                align-items: center;
            }
            
            nav li {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>BANK GAME - النظام المصرفي الافتراضي</h1>
        </div>
    </header>
    
    <nav>
        <ul>
            <li><a href="#" class="active" id="nav-home">الرئيسية</a></li>
            <li><a href="#" id="nav-accounts">الحسابات</a></li>
            <li><a href="#" id="nav-transfer">التحويلات</a></li>
            <li><a href="#" id="nav-crypto">المحافظ الرقمية</a></li>
            <li><a href="#" id="nav-profile">الملف الشخصي</a></li>
        </ul>
    </nav>
    
    <div class="container">
        <div id="login-page">
            <div class="card">
                <h2>تسجيل الدخول</h2>
                <div class="form-group">
                    <label for="login-username">اسم المستخدم</label>
                    <input type="text" id="login-username" class="form-control" placeholder="أدخل اسم المستخدم">
                </div>
                <div class="form-group">
                    <label for="login-password">كلمة المرور</label>
                    <input type="password" id="login-password" class="form-control" placeholder="أدخل كلمة المرور">
                </div>
                <button id="login-button" class="btn btn-primary">تسجيل الدخول</button>
                <p style="margin-top: 15px; text-align: center;">
                    ليس لديك حساب؟ <a href="#" id="show-register">سجل الآن</a>
                </p>
            </div>
        </div>
        
        <div id="register-page" style="display: none;">
            <div class="card">
                <h2>إنشاء حساب جديد</h2>
                <div class="form-group">
                    <label for="register-fullname">الاسم الكامل</label>
                    <input type="text" id="register-fullname" class="form-control" placeholder="أدخل الاسم الكامل">
                </div>
                <div class="form-group">
                    <label for="register-username">اسم المستخدم</label>
                    <input type="text" id="register-username" class="form-control" placeholder="أدخل اسم المستخدم">
                </div>
                <div class="form-group">
                    <label for="register-email">البريد الإلكتروني</label>
                    <input type="email" id="register-email" class="form-control" placeholder="أدخل البريد الإلكتروني">
                </div>
                <div class="form-group">
                    <label for="register-password">كلمة المرور</label>
                    <input type="password" id="register-password" class="form-control" placeholder="أدخل كلمة المرور">
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">تأكيد كلمة المرور</label>
                    <input type="password" id="register-confirm-password" class="form-control" placeholder="أعد إدخال كلمة المرور">
                </div>
                <button id="register-button" class="btn btn-primary">إنشاء الحساب</button>
                <p style="margin-top: 15px; text-align: center;">
                    لديك حساب بالفعل؟ <a href="#" id="show-login">تسجيل الدخول</a>
                </p>
            </div>
        </div>
        
        <div id="dashboard-page" style="display: none;">
            <div id="home-tab" class="tab-content active">
                <div class="card">
                    <h2>مرحباً، <span id="user-name">المستخدم</span></h2>
                    <div id="account-summary">
                        <h3>ملخص الحساب</h3>
                        <div class="account-card">
                            <div class="account-info">
                                <h3>الرصيد الحالي</h3>
                                <p>الحساب الرئيسي</p>
                            </div>
                            <div class="account-balance"><span id="main-balance">0</span> ريال</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>آخر المعاملات</h2>
                    <table id="recent-transactions">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>النوع</th>
                                <th>المبلغ</th>
                                <th>التفاصيل</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- البيانات ستضاف ديناميكيا باستخدام جافاسكريبت -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div id="accounts-tab" class="tab-content">
                <div class="card">
                    <h2>حساباتي</h2>
                    <div id="user-accounts">
                        <!-- الحسابات ستضاف ديناميكيا باستخدام جافاسكريبت -->
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3>إنشاء حساب جديد</h3>
                        <div class="form-group">
                            <label for="new-account-name">اسم الحساب</label>
                            <input type="text" id="new-account-name" class="form-control" placeholder="مثال: حساب التوفير">
                        </div>
                        <button id="create-account-button" class="btn btn-primary">إنشاء حساب</button>
                    </div>
                </div>
            </div>
            
            <div id="transfer-tab" class="tab-content">
                <div class="card">
                    <h2>تحويل الأموال</h2>
                    <div class="tabs">
                        <div class="tab active" data-target="internal-transfer">تحويل داخلي</div>
                        <div class="tab" data-target="external-transfer">تحويل لحساب آخر</div>
                    </div>
                    
                    <div id="internal-transfer" class="tab-content active">
                        <div class="form-group">
                            <label for="from-account">من حساب</label>
                            <select id="from-account" class="form-control">
                                <!-- الخيارات ستضاف ديناميكيا -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="to-account">إلى حساب</label>
                            <select id="to-account" class="form-control">
                                <!-- الخيارات ستضاف ديناميكيا -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transfer-amount">المبلغ</label>
                            <input type="number" id="transfer-amount" class="form-control" placeholder="أدخل المبلغ" min="1">
                        </div>
                        <div class="form-group">
                            <label for="transfer-note">ملاحظة (اختياري)</label>
                            <input type="text" id="transfer-note" class="form-control" placeholder="أدخل ملاحظة للتحويل">
                        </div>
                        <button id="internal-transfer-button" class="btn btn-primary">تحويل</button>
                    </div>
                    
                    <div id="external-transfer" class="tab-content">
                        <div class="form-group">
                            <label for="external-from-account">من حساب</label>
                            <select id="external-from-account" class="form-control">
                                <!-- الخيارات ستضاف ديناميكيا -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="recipient-username">اسم المستخدم المستلم</label>
                            <input type="text" id="recipient-username" class="form-control" placeholder="أدخل اسم المستخدم للمستلم">
                        </div>
                        <div class="form-group">
                            <label for="external-transfer-amount">المبلغ</label>
                            <input type="number" id="external-transfer-amount" class="form-control" placeholder="أدخل المبلغ" min="1">
                        </div>
                        <div class="form-group">
                            <label for="external-transfer-note">ملاحظة (اختياري)</label>
                            <input type="text" id="external-transfer-note" class="form-control" placeholder="أدخل ملاحظة للتحويل">
                        </div>
                        <button id="external-transfer-button" class="btn btn-primary">تحويل</button>
                    </div>
                </div>
            </div>
            
            <div id="crypto-tab" class="tab-content">
                <div class="card">
                    <h2>محافظ العملات الرقمية</h2>
                    <div id="crypto-wallets">
                        <!-- محافظ العملات الرقمية ستضاف ديناميكيا -->
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3>تحويل عملات رقمية</h3>
                        <div class="form-group">
                            <label for="crypto-from-wallet">من محفظة</label>
                            <select id="crypto-from-wallet" class="form-control">
                                <!-- الخيارات ستضاف ديناميكيا -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="crypto-to-address">إلى عنوان</label>
                            <input type="text" id="crypto-to-address" class="form-control" placeholder="أدخل عنوان المحفظة المستلمة">
                        </div>
                        <div class="form-group">
                            <label for="crypto-amount">المبلغ</label>
                            <input type="number" id="crypto-amount" class="form-control" placeholder="أدخل المبلغ" step="0.000001" min="0.000001">
                        </div>
                        <button id="crypto-transfer-button" class="btn btn-primary">تحويل</button>
                    </div>
                </div>
            </div>
            
            <div id="profile-tab" class="tab-content">
                <div class="card">
                    <h2>الملف الشخصي</h2>
                    <div class="form-group">
                        <label for="profile-fullname">الاسم الكامل</label>
                        <input type="text" id="profile-fullname" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="profile-email">البريد الإلكتروني</label>
                        <input type="email" id="profile-email" class="form-control">
                    </div>
                    <button id="update-profile-button" class="btn btn-primary">تحديث المعلومات</button>
                </div>
                
                <div class="card">
                    <h2>تغيير كلمة المرور</h2>
                    <div class="form-group">
                        <label for="current-password">كلمة المرور الحالية</label>
                        <input type="password" id="current-password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="new-password">كلمة المرور الجديدة</label>
                        <input type="password" id="new-password" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="confirm-new-password">تأكيد كلمة المرور الجديدة</label>
                        <input type="password" id="confirm-new-password" class="form-control">
                    </div>
                    <button id="change-password-button" class="btn btn-primary">تغيير كلمة المرور</button>
                </div>
                
                <div class="card" style="background-color: #fee2e2;">
                    <h2 style="color: var(--danger);">خيارات متقدمة</h2>
                    <button id="logout-button" class="btn btn-primary" style="margin-bottom: 10px;">تسجيل الخروج</button>
                    <button id="delete-account-button" class="btn btn-danger">حذف الحساب</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>BANK GAME &copy; 2025 - جميع الحقوق محفوظة</p>
            <p>هذا موقع افتراضي لأغراض تعليمية فقط</p>
        </div>
    </footer>
    
    <script>
        // بيانات النظام - ستخزن مؤقتًا في localStorage في هذا النموذج الأولي
        // في التطبيق الحقيقي، يجب استخدام قاعدة بيانات وواجهة API
        
        // التحقق من وجود بيانات مسبقة
        if (!localStorage.getItem('bankGameUsers')) {
            localStorage.setItem('bankGameUsers', JSON.stringify([]));
        }
        
        // العناصر المستخدمة بشكل متكرر
        const loginPage = document.getElementById('login-page');
        const registerPage = document.getElementById('register-page');
        const dashboardPage = document.getElementById('dashboard-page');
        
        const homeTab = document.getElementById('home-tab');
        const accountsTab = document.getElementById('accounts-tab');
        const transferTab = document.getElementById('transfer-tab');
        const cryptoTab = document.getElementById('crypto-tab');
        const profileTab = document.getElementById('profile-tab');
        
        const navLinks = document.querySelectorAll('nav a');
        
        // وظائف مساعدة
        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            // إزالة أي تنبيهات سابقة
            document.querySelectorAll('.alert').forEach(alert => alert.remove());
            
            // إضافة التنبيه في أعلى الصفحة الحالية
            const container = document.querySelector('.container');
            container.insertBefore(alertDiv, container.firstChild);
            
            // إزالة التنبيه بعد 5 ثوانٍ
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        
        function generateUniqueId() {
            return Date.now() + Math.random().toString(36).substring(2, 10);
        }
        
        function generateWalletAddress() {
            const chars = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            let address = '';
            for (let i = 0; i < 34; i++) {
                address += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return address;
        }
        
        function formatDate(date) {
            const d = new Date(date);
            return `${d.getDate()}/${d.getMonth() + 1}/${d.getFullYear()} ${d.getHours()}:${String(d.getMinutes()).padStart(2, '0')}`;
        }
        
        // نظام تسجيل المستخدمين
        document.getElementById('show-register').addEventListener('click', function(e) {
            e.preventDefault();
            loginPage.style.display = 'none';
            registerPage.style.display = 'block';
        });
        
        document.getElementById('show-login').addEventListener('click', function(e) {
            e.preventDefault();
            registerPage.style.display = 'none';
            loginPage.style.display = 'block';
        });
        
        document.getElementById('register-button').addEventListener('click', function() {
            const fullname = document.getElementById('register-fullname').value.trim();
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            // التحقق من البيانات
            if (!fullname || !username || !email || !password) {
                showAlert('يرجى تعبئة جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            if (password !== confirmPassword) {
                showAlert('كلمات المرور غير متطابقة', 'danger');
                return;
            }
            
            // التحقق من عدم وجود المستخدم مسبقاً
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            if (users.some(user => user.username === username)) {
                showAlert('اسم المستخدم موجود بالفعل، يرجى اختيار اسم آخر', 'danger');
                return;
            }
            
            // إنشاء المستخدم الجديد
            const newUser = {
                id: generateUniqueId(),
                fullname,
                username,
                email,
                password, // ملاحظة: في التطبيق الحقيقي، يجب تشفير كلمة المرور
                accounts: [
                    {
                        id: generateUniqueId(),
                        name: 'الحساب الرئيسي',
                        balance: 1000 // رصيد ابتدائي للمستخدمين الجدد
                    }
                ],
                cryptoWallets: [
                    {
                        id: generateUniqueId(),
                        name: 'بيتكوين',
                        symbol: 'BTC',
                        balance: 0.01,
                        address: generateWalletAddress()
                    },
                    {
                        id: generateUniqueId(),
                        name: 'إيثريوم',
                        symbol: 'ETH',
                        balance: 0.5,
                        address: generateWalletAddress()
                    },
                    {
                        id: generateUniqueId(),
                        name: 'ريبل',
                        symbol: 'XRP',
                        balance: 100,
                        address: generateWalletAddress()
                    }
                ],
                transactions: []
            };
            
            // حفظ المستخدم الجديد
            users.push(newUser);
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            showAlert('تم إنشاء الحساب بنجاح! يمكنك الآن تسجيل الدخول');
            registerPage.style.display = 'none';
            loginPage.style.display = 'block';
        });
        
        document.getElementById('login-button').addEventListener('click', function() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value;
            
            // التحقق من البيانات
            if (!username || !password) {
                showAlert('يرجى إدخال اسم المستخدم وكلمة المرور', 'danger');
                return;
            }
            
            // التحقق من بيانات تسجيل الدخول
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const user = users.find(u => u.username === username && u.password === password);
            
            if (!user) {
                showAlert('اسم المستخدم أو كلمة المرور غير صحيحة', 'danger');
                return;
            }
            
            // حفظ بيانات المستخدم الحالي
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // عرض لوحة التحكم
            loginPage.style.display = 'none';
            dashboardPage.style.display = 'block';
            
            // تحديث واجهة المستخدم
            updateDashboard();
            
            showAlert(`مرحباً ${user.fullname}! تم تسجيل دخولك بنجاح`);
        });
        
        // التنقل بين الصفحات
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // إزالة الفئة النشطة من جميع الروابط
                navLinks.forEach(l => l.classList.remove('active'));
                
                // إضافة الفئة النشطة للرابط الحالي
                this.classList.add('active');
                // تكملة لسكريبت الصفحة السابقة

                // إخفاء جميع التبويبات
                homeTab.classList.remove('active');
                accountsTab.classList.remove('active');
                transferTab.classList.remove('active');
                cryptoTab.classList.remove('active');
                profileTab.classList.remove('active');
                
                // عرض التبويب المحدد
                const tabId = this.id.replace('nav-', '') + '-tab';
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // تبديل التبويبة داخل صفحة التحويلات
        const transferTabs = document.querySelectorAll('.tabs .tab');
        transferTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                // إزالة الفئة النشطة من جميع التبويبات
                transferTabs.forEach(t => t.classList.remove('active'));
                
                // إضافة الفئة النشطة للتبويب الحالي
                this.classList.add('active');
                
                // إخفاء جميع محتويات التبويبات
                document.querySelectorAll('#transfer-tab .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // عرض محتوى التبويب المحدد
                const target = this.getAttribute('data-target');
                document.getElementById(target).classList.add('active');
            });
        });
        
        // وظائف تحديث واجهة المستخدم
        function updateDashboard() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) return;
            
            // تحديث اسم المستخدم والرصيد الرئيسي
            document.getElementById('user-name').textContent = currentUser.fullname;
            document.getElementById('main-balance').textContent = currentUser.accounts[0].balance;
            
            // تحديث قائمة الحسابات
            updateAccountsList();
            
            // تحديث قائمة المعاملات الأخيرة
            updateTransactionsList();
            
            // تحديث قائمة محافظ العملات الرقمية
            updateCryptoWallets();
            
            // تحديث معلومات الملف الشخصي
            document.getElementById('profile-fullname').value = currentUser.fullname;
            document.getElementById('profile-email').value = currentUser.email;
            
            // تحديث قوائم الحسابات في صفحة التحويلات
            updateTransferAccountLists();
        }
        
        function updateAccountsList() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const accountsContainer = document.getElementById('user-accounts');
            accountsContainer.innerHTML = '';
            
            currentUser.accounts.forEach(account => {
                const accountDiv = document.createElement('div');
                accountDiv.className = 'account-card';
                accountDiv.innerHTML = `
                    <div class="account-info">
                        <h3>${account.name}</h3>
                        <p>رقم الحساب: ${account.id.slice(-8)}</p>
                    </div>
                    <div class="account-balance">${account.balance} ريال</div>
                `;
                accountsContainer.appendChild(accountDiv);
            });
        }
        
        function updateTransactionsList() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const tbody = document.querySelector('#recent-transactions tbody');
            tbody.innerHTML = '';
            
            // عرض آخر 5 معاملات مرتبة من الأحدث إلى الأقدم
            const recentTransactions = [...currentUser.transactions]
                .sort((a, b) => b.date - a.date)
                .slice(0, 5);
            
            if (recentTransactions.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" style="text-align: center;">لا توجد معاملات حتى الآن</td>';
                tbody.appendChild(row);
            } else {
                recentTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formatDate(transaction.date)}</td>
                        <td>${transaction.type}</td>
                        <td class="${transaction.amount < 0 ? 'text-danger' : 'text-success'}">${transaction.amount} ريال</td>
                        <td>${transaction.description}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }
        
        function updateCryptoWallets() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const walletsContainer = document.getElementById('crypto-wallets');
            walletsContainer.innerHTML = '';
            
            // تحديث القائمة في صفحة المحافظ
            currentUser.cryptoWallets.forEach(wallet => {
                const walletDiv = document.createElement('div');
                walletDiv.className = 'crypto-wallet';
                walletDiv.innerHTML = `
                    <h3>${wallet.name} (${wallet.symbol})</h3>
                    <div class="wallet-address">عنوان المحفظة: ${wallet.address}</div>
                    <div class="crypto-balance">الرصيد: ${wallet.balance} ${wallet.symbol}</div>
                `;
                walletsContainer.appendChild(walletDiv);
            });
            
            // تحديث قائمة المحافظ في نموذج التحويل
            const selectWallet = document.getElementById('crypto-from-wallet');
            selectWallet.innerHTML = '';
            currentUser.cryptoWallets.forEach(wallet => {
                const option = document.createElement('option');
                option.value = wallet.id;
                option.textContent = `${wallet.name} (${wallet.balance} ${wallet.symbol})`;
                selectWallet.appendChild(option);
            });
        }
        
        function updateTransferAccountLists() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const fromAccount = document.getElementById('from-account');
            const toAccount = document.getElementById('to-account');
            const externalFromAccount = document.getElementById('external-from-account');
            
            // تنظيف القوائم
            fromAccount.innerHTML = '';
            toAccount.innerHTML = '';
            externalFromAccount.innerHTML = '';
            
            // تحديث القوائم بالحسابات المتاحة
            currentUser.accounts.forEach(account => {
                const option1 = document.createElement('option');
                option1.value = account.id;
                option1.textContent = `${account.name} (${account.balance} ريال)`;
                fromAccount.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = account.id;
                option2.textContent = `${account.name} (${account.balance} ريال)`;
                toAccount.appendChild(option2);
                
                const option3 = document.createElement('option');
                option3.value = account.id;
                option3.textContent = `${account.name} (${account.balance} ريال)`;
                externalFromAccount.appendChild(option3);
            });
        }
        
        // وظائف العمليات المصرفية
        document.getElementById('create-account-button').addEventListener('click', function() {
            const accountName = document.getElementById('new-account-name').value.trim();
            
            if (!accountName) {
                showAlert('يرجى إدخال اسم للحساب الجديد', 'danger');
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            // إنشاء الحساب الجديد
            const newAccount = {
                id: generateUniqueId(),
                name: accountName,
                balance: 0
            };
            
            // إضافة الحساب إلى حسابات المستخدم
            currentUser.accounts.push(newAccount);
            users[userIndex] = currentUser;
            
            // تحديث البيانات المخزنة
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            // تنظيف النموذج وتحديث الواجهة
            document.getElementById('new-account-name').value = '';
            updateDashboard();
            
            showAlert('تم إنشاء الحساب الجديد بنجاح');
        });
        
        document.getElementById('internal-transfer-button').addEventListener('click', function() {
            const fromAccountId = document.getElementById('from-account').value;
            const toAccountId = document.getElementById('to-account').value;
            const amount = parseFloat(document.getElementById('transfer-amount').value);
            const note = document.getElementById('transfer-note').value.trim();
            
            // التحقق من البيانات
            if (fromAccountId === toAccountId) {
                showAlert('لا يمكن التحويل إلى نفس الحساب', 'danger');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                showAlert('يرجى إدخال مبلغ صحيح', 'danger');
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            // البحث عن الحسابات المطلوبة
            const fromAccountIndex = currentUser.accounts.findIndex(acc => acc.id === fromAccountId);
            const toAccountIndex = currentUser.accounts.findIndex(acc => acc.id === toAccountId);
            
            // التحقق من وجود رصيد كافٍ
            if (currentUser.accounts[fromAccountIndex].balance < amount) {
                showAlert('الرصيد غير كافٍ لإتمام عملية التحويل', 'danger');
                return;
            }
            
            // إجراء عملية التحويل
            currentUser.accounts[fromAccountIndex].balance -= amount;
            currentUser.accounts[toAccountIndex].balance += amount;
            
            // إضافة المعاملة إلى سجل المعاملات
            const transaction = {
                id: generateUniqueId(),
                type: 'تحويل داخلي',
                date: Date.now(),
                fromAccount: currentUser.accounts[fromAccountIndex].name,
                toAccount: currentUser.accounts[toAccountIndex].name,
                amount: -amount,
                description: note || `تحويل إلى ${currentUser.accounts[toAccountIndex].name}`
            };
            
            currentUser.transactions.push(transaction);
            
            // إضافة معاملة مقابلة
            const counterTransaction = {
                id: generateUniqueId(),
                type: 'استلام تحويل',
                date: Date.now(),
                fromAccount: currentUser.accounts[fromAccountIndex].name,
                toAccount: currentUser.accounts[toAccountIndex].name,
                amount: amount,
                description: note || `استلام من ${currentUser.accounts[fromAccountIndex].name}`
            };
            
            currentUser.transactions.push(counterTransaction);
            
            // تحديث البيانات المخزنة
            users[userIndex] = currentUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            // تنظيف النموذج وتحديث الواجهة
            document.getElementById('transfer-amount').value = '';
            document.getElementById('transfer-note').value = '';
            updateDashboard();
            
            showAlert('تمت عملية التحويل بنجاح');
        });
        
        document.getElementById('external-transfer-button').addEventListener('click', function() {
            const fromAccountId = document.getElementById('external-from-account').value;
            const recipientUsername = document.getElementById('recipient-username').value.trim();
            const amount = parseFloat(document.getElementById('external-transfer-amount').value);
            const note = document.getElementById('external-transfer-note').value.trim();
            
            // التحقق من البيانات
            if (!recipientUsername) {
                showAlert('يرجى إدخال اسم المستخدم للمستلم', 'danger');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                showAlert('يرجى إدخال مبلغ صحيح', 'danger');
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const senderIndex = users.findIndex(u => u.id === currentUser.id);
            
            // البحث عن حساب المرسل
            const fromAccountIndex = currentUser.accounts.findIndex(acc => acc.id === fromAccountId);
            
            // التحقق من وجود رصيد كافٍ
            if (currentUser.accounts[fromAccountIndex].balance < amount) {
                showAlert('الرصيد غير كافٍ لإتمام عملية التحويل', 'danger');
                return;
            }
            
            // البحث عن المستلم
            const recipient = users.find(u => u.username === recipientUsername);
            
            if (!recipient) {
                showAlert('المستخدم المستلم غير موجود', 'danger');
                return;
            }
            
            if (recipient.id === currentUser.id) {
                showAlert('لا يمكن التحويل إلى نفسك', 'danger');
                return;
            }
            
            const recipientIndex = users.findIndex(u => u.id === recipient.id);
            
            // إجراء عملية التحويل
            // خصم المبلغ من حساب المرسل
            currentUser.accounts[fromAccountIndex].balance -= amount;
            
            // إضافة المبلغ إلى الحساب الرئيسي للمستلم
            recipient.accounts[0].balance += amount;
            
            // إضافة المعاملة إلى سجل معاملات المرسل
            const senderTransaction = {
                id: generateUniqueId(),
                type: 'تحويل خارجي',
                date: Date.now(),
                fromAccount: currentUser.accounts[fromAccountIndex].name,
                toAccount: `${recipient.username} (${recipient.accounts[0].name})`,
                amount: -amount,
                description: note || `تحويل إلى ${recipient.username}`
            };
            
            currentUser.transactions.push(senderTransaction);
            
            // إضافة المعاملة إلى سجل معاملات المستلم
            const recipientTransaction = {
                id: generateUniqueId(),
                type: 'استلام تحويل',
                date: Date.now(),
                fromAccount: `${currentUser.username} (${currentUser.accounts[fromAccountIndex].name})`,
                toAccount: recipient.accounts[0].name,
                amount: amount,
                description: note || `استلام من ${currentUser.username}`
            };
            
            recipient.transactions.push(recipientTransaction);
            
            // تحديث البيانات المخزنة
            users[senderIndex] = currentUser;
            users[recipientIndex] = recipient;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            // تنظيف النموذج وتحديث الواجهة
            document.getElementById('recipient-username').value = '';
            document.getElementById('external-transfer-amount').value = '';
            document.getElementById('external-transfer-note').value = '';
            updateDashboard();
            
            showAlert('تمت عملية التحويل الخارجي بنجاح');
        });
        
        document.getElementById('crypto-transfer-button').addEventListener('click', function() {
            const walletId = document.getElementById('crypto-from-wallet').value;
            const toAddress = document.getElementById('crypto-to-address').value.trim();
            const amount = parseFloat(document.getElementById('crypto-amount').value);
            
            // التحقق من البيانات
            if (!toAddress) {
                showAlert('يرجى إدخال عنوان المحفظة المستلمة', 'danger');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                showAlert('يرجى إدخال مبلغ صحيح', 'danger');
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            // البحث عن المحفظة المطلوبة
            const walletIndex = currentUser.cryptoWallets.findIndex(wallet => wallet.id === walletId);
            
            // التحقق من وجود رصيد كافٍ
            if (currentUser.cryptoWallets[walletIndex].balance < amount) {
                showAlert('الرصيد غير كافٍ لإتمام عملية التحويل', 'danger');
                return;
            }
            
            // إجراء عملية التحويل
            currentUser.cryptoWallets[walletIndex].balance -= amount;
            
            // إضافة المعاملة إلى سجل المعاملات
            const transaction = {
                id: generateUniqueId(),
                type: 'تحويل عملات رقمية',
                date: Date.now(),
                fromWallet: currentUser.cryptoWallets[walletIndex].name,
                toAddress: toAddress,
                amount: -amount,
                currency: currentUser.cryptoWallets[walletIndex].symbol,
                description: `تحويل ${amount} ${currentUser.cryptoWallets[walletIndex].symbol} إلى ${toAddress.substring(0, 8)}...`
            };
            
            currentUser.transactions.push(transaction);
            
            // تحديث البيانات المخزنة
            users[userIndex] = currentUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            // تنظيف النموذج وتحديث الواجهة
            document.getElementById('crypto-to-address').value = '';
            document.getElementById('crypto-amount').value = '';
            updateDashboard();
            
            showAlert('تمت عملية تحويل العملات الرقمية بنجاح');
        });
        
        document.getElementById('update-profile-button').addEventListener('click', function() {
            const fullname = document.getElementById('profile-fullname').value.trim();
            const email = document.getElementById('profile-email').value.trim();
            
            // التحقق من البيانات
            if (!fullname || !email) {
                showAlert('يرجى تعبئة جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            // تحديث البيانات
            currentUser.fullname = fullname;
            currentUser.email = email;
            
            // تحديث البيانات المخزنة
            users[userIndex] = currentUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            // تحديث الواجهة
            document.getElementById('user-name').textContent = fullname;
            
            showAlert('تم تحديث الملف الشخصي بنجاح');
        });
        
        document.getElementById('change-password-button').addEventListener('click', function() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmNewPassword = document.getElementById('confirm-new-password').value;
            
            // التحقق من البيانات
            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showAlert('يرجى تعبئة جميع الحقول المطلوبة', 'danger');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showAlert('كلمات المرور الجديدة غير متطابقة', 'danger');
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            // التحقق من كلمة المرور الحالية
            if (currentUser.password !== currentPassword) {
                showAlert('كلمة المرور الحالية غير صحيحة', 'danger');
                return;
            }
            
            // تحديث كلمة المرور
            currentUser.password = newPassword;
            
            // تحديث البيانات المخزنة
            users[userIndex] = currentUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            
            // تنظيف النموذج
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-new-password').value = '';
            
            showAlert('تم تغيير كلمة المرور بنجاح');
        });
        
        document.getElementById('logout-button').addEventListener('click', function() {
            // حذف بيانات المستخدم الحالي
            localStorage.removeItem('currentUser');
            
            // إعادة توجيه المستخدم إلى صفحة تسجيل الدخول
            dashboardPage.style.display = 'none';
            loginPage.style.display = 'block';
            
            showAlert('تم تسجيل الخروج بنجاح');
        });
        
        document.getElementById('delete-account-button').addEventListener('click', function() {
            if (!confirm('هل أنت متأكد من رغبتك في حذف حسابك؟ هذا الإجراء لا يمكن التراجع عنه!')) {
                return;
            }
            
            // الحصول على بيانات المستخدم الحالي
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const users = JSON.parse(localStorage.getItem('bankGameUsers'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            // حذف المستخدم
            users.splice(userIndex, 1);
            localStorage.setItem('bankGameUsers', JSON.stringify(users));
            localStorage.removeItem('currentUser');
            
            // إعادة توجيه المستخدم إلى صفحة تسجيل الدخول
            dashboardPage.style.display = 'none';
            loginPage.style.display = 'block';
            
            showAlert('تم حذف الحساب بنجاح');
        });

        // التحقق من وجود مستخدم مسجل
        window.addEventListener('load', function() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                loginPage.style.display = 'none';
                dashboardPage.style.display = 'block';
                updateDashboard();
            }
        });